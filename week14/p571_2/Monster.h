#pragma once
#include "Canvas.h"
#include "Point.h"

// Monster í´ë˜ìŠ¤: ê²Œì„ì˜ ê¸°ë³¸ ìºë¦­í„° ê°ì²´ (ì›€ì§ì„, ì•„ì´í…œ ìˆ˜ì§‘, í”¼ë¡œ ìƒíƒœ í¬í•¨)
class Monster {
public:
    string name, icon;  // ëª¬ìŠ¤í„° ì´ë¦„ê³¼ í™”ë©´ì— ì¶œë ¥ë  ì•„ì´ì½˜
    int nItem;          // ìˆ˜ì§‘í•œ ì•„ì´í…œ ê°œìˆ˜

    Point q, p;         // q: ì´ì „ ìœ„ì¹˜, p: í˜„ì¬ ìœ„ì¹˜
    int nSleep;         // ì ìëŠ” ë‚¨ì€ í„´ ìˆ˜ (í”¼ë¡œ ìƒíƒœ)
    double dist;        // ì—°ì† ì›€ì§ì„ ê±°ë¦¬
    double total;       // ì´ ì´ë™ ê±°ë¦¬

    // í˜„ì¬ ìœ„ì¹˜ê°€ ë§µ ë²”ìœ„ë¥¼ ë²—ì–´ë‚˜ì§€ ì•Šë„ë¡ í´ë¦¬í•‘
    void clip(int maxx, int maxy) { 
        p(maxx, maxy);  // Point í´ë˜ìŠ¤ì— ì˜¤ë²„ë¡œë”©ëœ ì—°ì‚°ì ()ê°€ ìˆì–´ì•¼ í•¨
    }

    // ì•„ì´í…œ ë¨¹ê¸° ë™ì‘ ë° ì´ë™ ê±°ë¦¬ ê³„ì‚°
    void eat(int** map) {
        if (map[p.y][p.x] == 1) {  // í•´ë‹¹ ìœ„ì¹˜ì— ì•„ì´í…œ(1)ì´ ìˆë‹¤ë©´
            map[p.y][p.x] = 0;     // ì•„ì´í…œ ì œê±°
            nItem++;               // ì•„ì´í…œ ìˆ˜ ì¦ê°€
        }
        dist += (double)(p - q);   // ì§ì „ ìœ„ì¹˜ì™€ì˜ ê±°ë¦¬ ì¶”ê°€
        total += (double)(p - q);  // ëˆ„ì  ì´ë™ ê±°ë¦¬ ì¶”ê°€
        q = p;                     // í˜„ì¬ ìœ„ì¹˜ë¥¼ ì´ì „ ìœ„ì¹˜ë¡œ ì—…ë°ì´íŠ¸

        // ì—°ì† ì´ë™ ê±°ë¦¬ê°€ 20ì„ ë„˜ìœ¼ë©´ í”¼ë¡œ ìƒíƒœë¡œ ì „í™˜
        if (dist > 20) {
            dist = 0;
            nSleep = 10;           // 10í„´ ë™ì•ˆ ì‰¬ê²Œ ë¨
        }
    }

    // ì ìëŠ” ìƒíƒœì¸ì§€ í™•ì¸
    bool isSleep() {
        if (nSleep > 0) {
            nSleep--;             // ì ì—ì„œ ê¹¨ì–´ë‚˜ëŠ” ì¹´ìš´íŠ¸ ê°ì†Œ
            return true;          // í˜„ì¬ëŠ” ì ìëŠ” ìƒíƒœ
        }
        return false;             // ê¹¨ì–´ ìˆìŒ
    }

public:
    // ìƒì„±ì: ì´ë¦„, ì•„ì´ì½˜, ì´ˆê¸° ìœ„ì¹˜ ì„¤ì •
    Monster(string n = "ì´ë¦„ì—†ìŒëª¬ìŠ¤í„°", string i = "ğŸ¾", int x = 0, int y = 0)
        : name(n), icon(i), nItem(0),
          p(x, y), q(x, y), nSleep(0), dist(0.0), total(0.0) {}

    // ì†Œë©¸ì: ë””ë²„ê¹…ìš© ì¶œë ¥ (ì•„ì´ì½˜, ì•„ì´í…œ ê°œìˆ˜, ì´ ì´ë™ ê±°ë¦¬)
    virtual ~Monster() {
        cout << icon << nItem << " ê±°ë¦¬: " << total << endl;
    }

    // ìº”ë²„ìŠ¤ì— ëª¬ìŠ¤í„° ê·¸ë¦¬ê¸°
    void draw(Canvas &canvas) {
        canvas.draw(p, icon);
    }

    // ëª¬ìŠ¤í„° ìë™ ì´ë™ (ì ìëŠ” ìƒíƒœ ì•„ë‹ˆë©´ ë¬´ì‘ìœ„ ì´ë™)
    virtual void move(int** map, int maxx, int maxy) {
        if (!isSleep()) {
            int num = rand() % 9 + 1; // 1~9 ë¬´ì‘ìœ„ ìˆ«ì
            p += Point(num % 3 - 1, num / 3 - 1); // ìƒí•˜ì¢Œìš° ëŒ€ê°ì„  í¬í•¨ 8ë°©í–¥ ì´ë™
            clip(maxx, maxy);  // ê²½ê³„ ë²—ì–´ë‚˜ì§€ ì•Šê²Œ ì¡°ì •
            eat(map);          // ì•„ì´í…œ ë¨¹ê¸° ì‹œë„
        }
    }

    // ëª¬ìŠ¤í„° ìƒíƒœ ì¶œë ¥
    void print() {
        cout << "\t" << name << " " << icon << " : ì•„ì´í…œ " << nItem << "ê°œ, ë‚¨ì€ íœ´ì‹ " << nSleep << endl;
    }
};
